<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MS Teams PFP Gen</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="page">
        <header class="header">
            <h1 class="title">Microsoft Teams Profile <span class="title-accent">Picture Generator</span></h1>
            <p class="subtitle">Create your personalized initials logo</p>
        </header>

        <div class="input-section">
            <form id="initials-form" class="initials-form">
                <input type="text" id="initials" name="initials" maxlength="2" placeholder="Enter 2 initials" autocomplete="off">
                <button type="submit" class="btn btn-primary">Generate</button>
            </form>
        </div>

        <section class="section">
            <h2 class="section-title">Preset Themes</h2>
            <p class="section-desc">Click a theme to preview, then download it</p>
            <div class="presets-grid">
                <div class="preset-card" data-bg="#F8EACD" data-text="#775717">
                    <div class="preset-logo-wrap">
                        <div class="preset-logo">
                            <div class="preset-circle" style="background:#F8EACD;"></div>
                            <span class="preset-pair" style="color:#775717;">TA</span>
                        </div>
                    </div>
                    <span class="preset-label">Warm Gold</span>
                    <button class="btn btn-small btn-download preset-download">Download</button>
                </div>
                <div class="preset-card" data-bg="#D4E8F0" data-text="#1A5276">
                    <div class="preset-logo-wrap">
                        <div class="preset-logo">
                            <div class="preset-circle" style="background:#D4E8F0;"></div>
                            <span class="preset-pair" style="color:#1A5276;">TA</span>
                        </div>
                    </div>
                    <span class="preset-label">Ocean Blue</span>
                    <button class="btn btn-small btn-download preset-download">Download</button>
                </div>
                <div class="preset-card" data-bg="#E8D5E0" data-text="#6B2D5B">
                    <div class="preset-logo-wrap">
                        <div class="preset-logo">
                            <div class="preset-circle" style="background:#E8D5E0;"></div>
                            <span class="preset-pair" style="color:#6B2D5B;">TA</span>
                        </div>
                    </div>
                    <span class="preset-label">Plum Berry</span>
                    <button class="btn btn-small btn-download preset-download">Download</button>
                </div>
                <div class="preset-card" data-bg="#D5E5D0" data-text="#2D5A27">
                    <div class="preset-logo-wrap">
                        <div class="preset-logo">
                            <div class="preset-circle" style="background:#D5E5D0;"></div>
                            <span class="preset-pair" style="color:#2D5A27;">TA</span>
                        </div>
                    </div>
                    <span class="preset-label">Forest Green</span>
                    <button class="btn btn-small btn-download preset-download">Download</button>
                </div>
                <div class="preset-card" data-bg="#2C2C2C" data-text="#E8C872">
                    <div class="preset-logo-wrap">
                        <div class="preset-logo">
                            <div class="preset-circle" style="background:#2C2C2C;"></div>
                            <span class="preset-pair" style="color:#E8C872;">TA</span>
                        </div>
                    </div>
                    <span class="preset-label">Dark Luxe</span>
                    <button class="btn btn-small btn-download preset-download">Download</button>
                </div>
            </div>
        </section>

        <section class="section">
            <h2 class="section-title">Custom Colors</h2>
            <p class="section-desc">Design your own color scheme</p>
            <div class="custom-area">
                <div class="custom-preview">
                    <div class="logo" id="custom-logo">
                        <div class="circle" id="custom-circle"></div>
                        <span class="letter-pair" id="custom-pair">TA</span>
                    </div>
                </div>
                <div class="custom-controls">
                    <div class="color-row">
                        <label class="color-label" for="circle-color">Circle Color</label>
                        <div class="color-input-wrap">
                            <input type="color" id="circle-color" value="#F8EACD" class="color-input">
                            <span class="color-hex" id="circle-hex">#F8EACD</span>
                        </div>
                    </div>
                    <div class="color-row">
                        <label class="color-label" for="letter-color">Letter Color</label>
                        <div class="color-input-wrap">
                            <input type="color" id="letter-color" value="#775717" class="color-input">
                            <span class="color-hex" id="letter-hex">#775717</span>
                        </div>
                    </div>
                    <button class="btn btn-primary btn-download-custom" id="download-custom">Download Custom Logo</button>
                </div>
            </div>
        </section>
    </div>

    <script>
        let currentInitials = ['T', 'A'];

        const form = document.getElementById('initials-form');
        const customPair = document.getElementById('custom-pair');
        const customCircle = document.getElementById('custom-circle');
        const circleColorInput = document.getElementById('circle-color');
        const letterColorInput = document.getElementById('letter-color');
        const circleHex = document.getElementById('circle-hex');
        const letterHex = document.getElementById('letter-hex');

        function updateAllInitials() {
            const text = currentInitials[0] + currentInitials[1];
            customPair.textContent = text;
            document.querySelectorAll('.preset-pair').forEach(pair => {
                pair.textContent = text;
            });
        }

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const value = form.elements['initials'].value.trim().toUpperCase();
            if (value.length >= 2) {
                currentInitials = [value[0], value[1]];
                updateAllInitials();
            }
        });

        circleColorInput.addEventListener('input', () => {
            const c = circleColorInput.value;
            customCircle.style.background = c;
            circleHex.textContent = c.toUpperCase();
        });

        letterColorInput.addEventListener('input', () => {
            const c = letterColorInput.value;
            customPair.style.color = c;
            letterHex.textContent = c.toUpperCase();
        });

        function downloadLogo(bgColor, textColor, filename) {
            const size = 444;
            const fontSize = 180;
            const canvas = document.createElement('canvas');
            canvas.width = size;
            canvas.height = size;
            const ctx = canvas.getContext('2d');

            // Draw circle
            ctx.beginPath();
            ctx.arc(size / 2, size / 2, size / 2, 0, Math.PI * 2);
            ctx.fillStyle = bgColor;
            ctx.fill();

            // Draw initials as a single string so the browser handles natural kerning
            ctx.font = `600 ${fontSize}px "MyCustomFont", "Segoe UI", sans-serif`;
            ctx.fillStyle = textColor;
            ctx.textBaseline = 'middle';
            ctx.textAlign = 'center';

            const text = currentInitials[0] + currentInitials[1];
            // Slight upward nudge to visually center uppercase letters (no descenders)
            ctx.fillText(text, size / 2, size / 2 + 2);

            canvas.toBlob((blob) => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename || 'ms-teams-pfp.png';
                a.click();
                URL.revokeObjectURL(url);
            }, 'image/png');
        }

        document.querySelectorAll('.preset-card').forEach(card => {
            const btn = card.querySelector('.preset-download');
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                const bg = card.dataset.bg;
                const text = card.dataset.text;
                const label = card.querySelector('.preset-label').textContent.toLowerCase().replace(/\s+/g, '-');
                downloadLogo(bg, text, `ms-teams-pfp-${label}.png`);
            });
        });

        document.getElementById('download-custom').addEventListener('click', () => {
            downloadLogo(circleColorInput.value, letterColorInput.value, 'ms-teams-pfp-custom.png');
        });

    </script>
</body>
</html>